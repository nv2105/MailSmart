{% extends "base.html" %}
{% block content %}
<h1>ðŸ“œ History of Summaries</h1>

{% if history %}
  <ul class="history-list">
    {% for h in history %}
      <li>
        <h3>{{ h.run_time }}</h3>
        <p><strong>Total Emails:</strong> {{ h.total_emails }}</p>
        <p><strong>Important Emails:</strong> {{ h.important_emails|length }}</p>

        {% if h.important_emails %}
          <p><strong>Top Summaries:</strong></p>
          <ul>
            {% for email in h.important_emails[:5] %}
              <li><strong>{{ email.sender }}</strong> - {{ email.subject|truncate(50, True) }}<br>{{ email.summary|truncate(100, True) }}</li>
            {% endfor %}
          </ul>

          {% if h.important_emails|length > 5 %}
            <button class="toggle-btn" onclick="toggleDetails('details-{{ loop.index }}')">Show All</button>
            <ul id="details-{{ loop.index }}" style="display:none;">
              {% for email in h.important_emails[5:] %}
                <li><strong>{{ email.sender }}</strong> - {{ email.subject|truncate(50, True) }}<br>{{ email.summary }}</li>
              {% endfor %}
            </ul>
          {% endif %}
        {% else %}
          <p>No important summaries for this run.</p>
        {% endif %}
      </li>
    {% endfor %}
  </ul>
{% else %}
  <p>No history available yet.</p>
{% endif %}

<!-- Toast notification -->
<div id="toast" class="toast">Summary loaded successfully!</div>

<script>
function toggleDetails(id) {
  const el = document.getElementById(id);
  if (el.style.display === "none") {
    el.style.display = "block";
  } else {
    el.style.display = "none";
  }
}

// Optional: show toast on page load if there is history
window.addEventListener("DOMContentLoaded", () => {
  if ({{ history|length }} > 0) {
    const toast = document.getElementById("toast");
    toast.classList.add("show");
    setTimeout(() => toast.classList.remove("show"), 3000);
  }
});
</script>
{% endblock %}
